<!DOCTYPE HTML>
<html lang="zh">

<head>
  <title>UPEX</title>
  @@include('header.html')
  <link rel="stylesheet" href="../styles/all_goods.css?rev=@@hash">
  <link rel="stylesheet" href="../styles/my_goods.css?rev=@@hash">
</head>

<body>
  <div id="app" v-cloak>
    <!--header-->
    <o-header ref="header"></o-header>
    <div class="banner"></div>

    <div class="list wrapper">
      <Row>
        <i-col class="tags" :span="4" :class="showListTag == 'BUY' ? 'act' :'disact' ">
          <span @click="showListTag='BUY'">{{ $t('buy') }} USDT</span>
        </i-col>
        <i-col class="tags" :span="4" :class="showListTag == 'SELL' ? 'act' :'disact' ">
          <span @click="showListTag='SELL'">{{ $t('sell') }} USDT</span>
        </i-col>
        <i-col span="16" style="margin-top:10px;">
          <div class="text-right">
            <span class="mr-10">{{ $t('notSatisfied') }} ?</span>
            <i-button type="ghost" shape="circle" size="small" class="btn-show-release" :loading="modalReleaseLoading" @click="showModalRelease">
              <Icon type="plus-round"></Icon>
              {{ $t('releaseAdvert') }}
            </i-button>
          </div>
        </i-col>
      </Row>
      <div>
        <div v-show="showListTag == 'BUY'">
          <div class="list-table">
            <table class="buylist">
              <thead>
                <tr>
                  <th>{{ $t('seller') }}</th>
                  <th>{{ $t('amount') }}</th>
                  <th>
                    {{ $t('limit') }}
                    <br/>
                    <span class="limit-tips">({{ $t('min2maxPurchase') }})</span>
                  </th>
                  <th>{{ $t('unitPrice') }}</th>
                  <th>{{ $t('payment') }}</th>
                  <th>{{ $t('operation') }}</th>
                </tr>
              </thead>
              <tbody>
                <tr v-for="item in buylist" :key="item.id">
                  <td>
                    <span class="avatar mr-10" :class="userInfo.id == item.userId ? 'mine' : ''">
                      {{ userInfo.id == item.userId ? $t('mine') : $t('seller') }}
                    </span>
                    {{item.userName}}
                  </td>
                  <td>{{(item.volume - item.sell).toFixed(4)}} USDT</td>
                  <td>
                    {{item.minTrade}}--{{item.maxTrade}} SAR
                  </td>
                  <td class="price">{{item.price}} SAR</td>
                  <td>{{item.paymentBanks[0].bankName}}</td>
                  <td>
                    <template v-if="userInfo.id == item.userId">
                      <i-button
                        @click="pause(item)" 
                        :disabled="item.status === 3 || item.status === 4 || item.status === 5"
                        type="link"
                        size="small"
                      >
                        {{ item.status === 6 ? $t('start') : $t('pause') }}
                      </i-button>
                      <i-button
                        @click="cancel(item)"
                        :disabled="item.status === 4 || item.status === 5"
                        type="link"
                        size="small"
                      >
                        {{ $t('cancel') }}
                      </i-button>
                    </template>
                    <i-button type="primary" size="small" @click="showModalOrder(item, 'BUY')" v-else>{{ $t('buy') }} USDT</i-button>
                  </td>
                </tr>
                <tr v-if="!buylist.length"><td colspan="6">{{ $t('noData') }}</td></tr>
              </tbody>
            </table>
          </div>
          <div class="page">
            <div class="wrapper">
              <div>
                <Page @on-change="getAdvertList('BUY', $event)" :total="buyTotal" :current="buyCurrentPage" size="small"></Page>
              </div>
            </div>
          </div>
        </div>
        <div v-show="showListTag == 'SELL'">
          <div class="list-table">
            <table class="buylist">
              <thead>
                <tr>
                  <th>{{ $t('buyer') }}</th>
                  <th>{{ $t('amount') }}</th>
                  <th>
                    {{ $t('limit') }}
                    <br/>
                    <span class="limit-tips">({{ $t('min2maxPurchase') }})</span>
                  </th>
                  <th>{{ $t('unitPrice') }}</th>
                  <th>{{ $t('operation') }}</th>
                </tr>
              </thead>
              <tbody>
                <tr v-for="item in selllist" :key="item.id">
                  <td>
                    <span class="avatar mr-10" :class="userInfo.id == item.userId ? 'mine' : ''">
                      {{ userInfo.id == item.userId ? $t('mine') : $t('buyer') }}
                    </span>
                    {{item.userName}}
                  </td>
                  <td>{{(item.volume - item.sell).toFixed(4)}} USDT</td>
                  <td>
                    {{item.minTrade}}--{{item.maxTrade}} SAR
                  </td>
                  <td class="price">{{item.price}} SAR</td>
                  <td>
                    <template v-if="userInfo.id == item.userId">
                      <i-button
                        @click="pause(item)"
                        :disabled="item.status === 3 || item.status === 4 || item.status === 5"
                        type="link"
                        size="small"
                      >
                        {{ item.status === 6 ? $t('start') : $t('pause') }}
                      </i-button>
                      <i-button
                        @click="cancel(item)"
                        :disabled="item.status === 4 || item.status === 5"
                        type="link"
                        size="small"
                      >
                        {{ $t('cancel') }}
                      </i-button>
                    </template>
                    <i-button type="primary" size="small" @click="showModalOrder(item, 'SELL')" v-else>{{ $t('sell') }} USDT</i-button>
                  </td>
                </tr>
                <tr v-if="!selllist.length"><td colspan="5">{{ $t('noData') }}</td></tr>
              </tbody>
            </table>
          </div>
          <div class="page">
            <div class="wrapper">
              <div>
                <Page @on-change="getAdvertList('SELL', $event)" :total="sellTotal" :current="sellCurrentPage" size="small"></Page>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!--buy-sell-modal-->
    <div class="o-modal buy-sell-modal" :class="modalOrder? 'is-show':'is-not-show' ">
      <div class="content">
        <div class="content-wrapper" style="padding: 20px;width: 1200px;">
          <Icon type="close-circled" class="o-close" @click="closeBuyDialog"></Icon>
          <div v-if="showListTag == 'BUY'">
            {{ $t('balance') }} {{balance}} USDT
          </div>
          <Row>
            <i-col span="4">
              <p class="item-name">{{ $t('amount') }}:</p>
              <p class="item-name" v-if="buyData.method">{{ $t('payment') }}:</p>
            </i-col>
            <i-col span="3">
              <p class="txt-bold">{{buyData.restAmount}}</p>
              <p class="txt-bold" v-if="buyData.method" v-html="buyData.method"></p>
            </i-col>
            <i-col span="6">
              <div class="order-input-wrapper">
                <div class="order-input" :class="buyAmountErrorText ? 'error' : ''">
                  <input type="number" v-model="buyData.buyAmount" @input="changeAmount($event)" @focus="buyAmountAppendText = 'All'" @blur="buyAmountAppendText = 'SAR'"
                  />
                  <div class="order-input-append">
                    <span @click="tradeAll('amount')">{{ buyAmountAppendText }}</span>
                  </div>
                </div>
                <p class="order-input-tips" :class="buyAmountErrorText ? 'error' : ''">
                  {{ $t('limit') }}: {{buyAmountMin}} -- {{buyAmountMax}}SAR
                </p>
              </div>
            </i-col>
            <i-col span="1" class="txt-center">
              <Icon type="arrow-swap" size="18" color="#666" style="margin-top:16px"></Icon>
            </i-col>
            <i-col span="6">
              <div class="order-input-wrapper">
                <div class="order-input" :class="buyTotalErrorText ? 'error' : ''">
                  <input type="number" v-model="buyData.buyTotal" @input="changeTotal($event)" @focus="buyTotalAppendText = 'All'" @blur="buyTotalAppendText = 'USDT'"
                  />
                  <div class="order-input-append">
                    <span @click="tradeAll('total')">{{ buyTotalAppendText }}</span>
                  </div>
                </div>
                <p class="order-input-tips" :class="buyTotalErrorText ? 'error' : ''">
                  {{ $t('limit') }}:{{ buyTotalMin }} -- {{ buyTotalMax }}USDT
                </p>
              </div>
            </i-col>
            <i-col span="4" class="btn-wrapper">
              <button v-show="showListTag == 'BUY'" @click="confirmOrder('BUY')" class="order-btn">{{ $t('buy') }}</button>
              <button v-show="showListTag == 'SELL'" @click="confirmOrder('SELL')" class="order-btn">{{ $t('sell') }}</button>
            </i-col>
          </Row>
        </div>
      </div>
    </div>

    <!-- 填写挂单信息 -->
    <Modal :title="$t('releaseAdvert')" :mask-closable="false" v-model="modalRelease" @on-cancel="handleReset('formRelease')">
      <i-form ref="formRelease" :model="formRelease" :rules="ruleRelease" label-position="top">
        <Row>
          <i-col span="8" class="text-strong">挂单类型</i-col>
        </Row>
        <form-item prop="side">
          <radio-group v-model="formRelease.side">
            <Radio label="BUY" :disabled="buyDisabled">{{ $t('buy') + 'USDT' }}</Radio>
            <Radio label="SELL" :disabled="sellDisabled">{{ $t('sell') + 'USDT' }}</Radio>
          </radio-group>
        </form-item>
        <Row>
          <i-col span="8" class="text-strong">{{ $t('unitPrice') }}</i-col>
          <i-col span="16" class="text-right">{{ $t('currentPrice') }} {{marketPrice.exchange_sell_min || marketPrice.exchange_rate }} SAR</i-col>
        </Row>
        <form-item label="" prop="price">
          <i-input
            number
            v-model="formRelease.price"
            :min="marketPrice.trade_min_price"
            :max="marketPrice.trade_max_price"
            :placeholder="$t('pricePlaceholder')"
          >
            <span slot="prepend">SAR</span>
          </i-input>
        </form-item>
        <Row>
          <i-col span="8" class="text-strong">{{ $t('quantity') }}</i-col>
          <i-col span="16" class="text-right" v-show="formRelease.side === 'SELL'">{{ $t('balance') }} {{balance}} USDT</i-col>
        </Row>
        <form-item label="" prop="volume">
          <i-input
            number
            v-model="formRelease.volume"
            :min="marketPrice.trade_min_volume"
            :max="releaseMaxVolume"
            :placeholder="$t('amountPlaceholder')"
          >
            <span slot="prepend">USDT</span>
          </i-input>
        </form-item>
        <Row class="text-strong" style="margin-bottom: 24px;">{{ $t('totalPrice') }}(SAR): {{ releaseTotalPrice || 0 }}</Row>
        <Row class="text-strong">{{ $t('transactionLimit') }}(SAR)</Row>
        <Row>
          <i-col span="11">
            <form-item prop="minTrade">
              <i-input
                number
                v-model="formRelease.minTrade"
                :min="marketPrice.trade_min_price"
                :max="marketPrice.trade_max_price"
              >
                <span slot="prepend">Min</span>
              </i-input>
            </form-item>
          </i-col>
          <i-col class="text-center" span="2" style="margin-top:10px">--</i-col>
          <i-col span="11">
            <form-item prop="maxTrade">
              <i-input
                number
                v-model="formRelease.maxTrade"
                :min="marketPrice.trade_min_price"
                :max="marketPrice.trade_max_price"
              >
                <span slot="prepend">Max</span>
              </i-input>
            </form-item>
          </i-col>
        </Row>
      </i-form>
      <div slot="footer">
          <i-button type="link" @click="handleReset('formRelease')">{{ $t('cancel') }}</i-button>
          <i-button type="primary" @click="handleSubmit('formRelease')">{{ $t('confirm') }}</i-button>
        </div>
    </Modal>

    <!-- 挂单价格提醒 -->
    <Modal :title="$t('deviationWarn')" :mask-closable="false" v-model="modalReleaseWarning" class="modal-notice warning">
      <div class="modal-notice-header text-center">
        <img src="../images/warning.png" alt="">
        <p class="text-white">{{ releaseWarning }}</p>
      </div>
      <div class="modal-notice-footer">
        <Row>
          <i-col span="10">{{ $t('currentPrice') }}</i-col>
          <i-col span="14">{{marketPrice.exchange_sell_min || marketPrice.exchange_rate}} SAR</i-col>
        </Row>
        <Row>
          <i-col span="10">{{ $t('currentReleasePrice') }}</i-col>
          <i-col span="14" class="text-error">{{ formRelease.price }} SAR</i-col>
        </Row>
      </div>
      <div slot="footer">
        <i-button type="link" @click="continueRelease">{{ $t('confirmRelease') }}</i-button>
        <i-button type="primary" @click="modifyRelease" >{{ $t('modifyNow') }}</i-button>
      </div>
    </Modal>

    <!-- 确认挂单 -->
    <Modal :title="$t('confirmRelease')" :mask-closable="false" v-model="modalReleaseConfirm" class="modal-notice" @on-cancel="handleReset('formReleaseConfirm')">
      <div class="modal-notice-header">
        <Row>
          <i-col span="6">{{ $t('unitPrice') }}</i-col>
          <i-col span="18" class="text-strong">{{ formRelease.price }} SAR</i-col>
          </Row>
          <Row>
            <i-col span="6">{{ $t('quantity') }}</i-col>
            <i-col span="18" class="text-strong">{{ formRelease.volume }} USDT</i-col>
          </Row>
          <Row>
            <i-col span="6">{{ $t('limit') }}</i-col>
            <i-col span="18" class="text-strong">{{ formRelease.minTrade }} SAR -- {{ formRelease.maxTrade }} SAR</i-col>
          </Row>
          <Row>
            <i-col span="6">{{ $t('totalPrice') }}</i-col>
            <i-col span="18" class="text-strong">{{ (formRelease.price * formRelease.volume).toFixed(2) }} SAR</i-col>
        </Row>
      </div>
      <div class="modal-notice-header border-top-dashed" v-show="formRelease.side === 'SELL'">
        <Row>
        <i-col span="6">WhatsApp</i-col>
        <i-col span="18" class="text-strong">{{ userInfo.watchapp }}</i-col>
        </Row>
        <Row>
          <i-col span="6">{{ $t('bankCard') }}</i-col>
        </Row>
        <Row v-for="item in cardList" :key="item.id" style="line-height: 26px">
          <i-col span="18">
            <h4 class="text-strong">{{ item.bankName }}</h4>
            <p>{{ item.cardNo }}</p>
          </i-col>
          <i-col span="6" class="text-right">
            <i-switch :value="!!item.status" size="large" @on-change="changeCardStatus($event, item)">
              <span slot="open">YES</span>
              <span slot="close">NO</span>
            </i-switch>
          </i-col>
        </Row>
      </div>
      <div class="modal-notice-footer border-top-dashed">
        <i-form ref="formReleaseConfirm" :model="formReleaseConfirm" :rules="ruleReleaseConfirm" label-position="top">
          <Tabs v-model="tabVerifyActive">
            <tab-pane :label="$t('googleVerification')" :name="1">
              <form-item label="" prop="google">
                <i-input v-model="formReleaseConfirm.google" :maxlength="6" @on-change="autoSubmit($event, 'formReleaseConfirm')" :placeholder="$t('googleVerificationHolder')"></i-input>
              </form-item>
            </tab-pane>
            <tab-pane :label="$t('phoneVerification')" :name="2">
              <form-item label="" prop="phone">
                <i-input v-model="formReleaseConfirm.phone" :maxlength="6" @on-change="autoSubmit($event, 'formReleaseConfirm')" :placeholder="$t('phoneVerificationHolder')">
                  <i-button slot="append" @click="sendMessage('Bank', 3)" :disabled="sendDisabledBank">{{ sendPlaceholderBank }}</i-button>
                </i-input>
              </form-item>
            </tab-pane>
          </Tabs>
        </i-form>
      </div>
      <div slot="footer">
        <i-button type="link" @click="handleReset('formReleaseConfirm', 'modify')">{{ $t('backEdit') }}</i-button>
        <i-button type="primary" @click="handleSubmit('formReleaseConfirm')">{{ $t('confirmRelease') }}</i-button>
      </div>
    </Modal>

    <!-- 添加/修改银行卡 -->
    <div data-id="modifyBankCard">
      <Modal :title="$t('addBankCard')" :mask-closable="false" v-model="modalBankInfo" @on-cancel="handleReset('formBankInfo')">
        <i-form ref="formBankInfo" :model="formBankInfo" :rules="ruleBankInfo" label-position="top">
          <form-item :label="$t('bankName')" prop="bankName">
            <i-select v-model="formBankInfo.bankName" :placeholder="$t('bankNameHolder')">
              <i-option :value="$t('AlRajhiBank')">{{ $t('AlRajhiBank') }}</i-option>
              <i-option :value="$t('TheNationalCommercialBank')">{{ $t('TheNationalCommercialBank') }}</i-option>
              <i-option :value="$t('TheSaudiBritishBank')">{{ $t('TheSaudiBritishBank') }}</i-option>
              <i-option :value="$t('SaudiInvestmentBank')">{{ $t('SaudiInvestmentBank') }}</i-option>
              <i-option :value="$t('AlinmaBank')">{{ $t('AlinmaBank') }}</i-option>
              <i-option :value="$t('BanqueSaudiFransi')">{{ $t('BanqueSaudiFransi') }}</i-option>
              <i-option :value="$t('RiyadBank')">{{ $t('RiyadBank') }}</i-option>
              <i-option :value="$t('SambaFinancialGroup(Samba)')">{{ $t('SambaFinancialGroup(Samba)') }}</i-option>
              <i-option :value="$t('SaudiHollandiBank')">{{ $t('SaudiHollandiBank') }}</i-option>
              <i-option :value="$t('ArabNationalBank')">{{ $t('ArabNationalBank') }}</i-option>
              <i-option :value="$t('BankAl-Bliad')">{{ $t('BankAl-Bliad') }}</i-option>
              <i-option :value="$t('BankAljazira')">{{ $t('BankAljazira') }}</i-option>
            </i-select>
          </form-item>
          <form-item :label="$t('accountName')" prop="name">
            <i-input v-model="formBankInfo.name" :maxlength="64" :placeholder="$t('accountNameHolder')"></i-input>
          </form-item>
          <form-item :label="$t('cardNo')" prop="cardNo">
            <Poptip trigger="focus" :content="formBankInfo.cardNo | card" class="poptip-card">
              <i-input v-model="formBankInfo.cardNo" :maxlength="64" :placeholder="$t('cardNoHolder')"></i-input>
            </Poptip>
          </form-item>
          <form-item :label="'iban' + $t('number')" prop="ibanNo">
            <i-input v-model="formBankInfo.ibanNo" :maxlength="64" :placeholder="$t('ibanNoHolder')"></i-input>
          </form-item>
        </i-form>
        <div slot="footer">
          <i-button type="link" @click="handleReset('formBankInfo')" style="margin-left: 8px">{{ $t('cancel') }}</i-button>
          <i-button type="primary" @click="handleSubmit('formBankInfo')">{{ $t('nextStep') }}</i-button>
        </div>
      </Modal>
      <Modal :title="$t('confirmBind')" :mask-closable="false" class="modal-notice info" v-model="modalBankConfirm" @on-cancel="handleReset('formBankConfirm')">
        <div class="modal-notice-header">
          <Row>
            <i-col span="8" class="text-secondary">{{ $t('bankName') }}</i-col>
            <i-col span="16" class="text-strong">{{ formBankInfo.bankName }}</i-col>
          </Row>
          <Row>
            <i-col span="8" class="text-secondary">{{ $t('accountName') }}</i-col>
            <i-col span="16" class="text-strong">{{ formBankInfo.name }}</i-col>
          </Row>
          <Row>
            <i-col span="8" class="text-secondary">{{ $t('cardNo') }}</i-col>
            <i-col span="16" class="text-strong">{{ formBankInfo.cardNo }}</i-col>
          </Row>
          <Row>
            <i-col span="8" class="text-secondary">iban{{ $t('number') }}</i-col>
            <i-col span="16" class="text-strong">{{ formBankInfo.ibanNo }}</i-col>
          </Row>
        </div>
        <div class="modal-notice-footer">
          <i-form ref="formBankConfirm" :model="formBankConfirm" :rules="ruleBankConfirm" label-position="top">
            <Tabs v-model="tabVerifyActive">
              <tab-pane :label="$t('googleVerification')" :name="1">
                <form-item label="" prop="google">
                  <i-input v-model="formBankConfirm.google" number :maxlength="6" @on-change="autoSubmit($event, 'formBankConfirm')" :placeholder="$t('googleVerificationHolder')"></i-input>
                </form-item>
              </tab-pane>
              <tab-pane :label="$t('phoneVerification')" :name="2">
                <form-item label="" prop="phone">
                  <i-input v-model="formBankConfirm.phone" number :maxlength="6" @on-change="autoSubmit($event, 'formBankConfirm')" :placeholder="$t('phoneVerificationHolder')">
                    <i-button slot="append" @click="sendMessage('Bank', 3)" :disabled="sendDisabledBank">{{ sendPlaceholderBank }}</i-button>
                  </i-input>
                </form-item>
              </tab-pane>
            </Tabs>
          </i-form>
        </div>
        <div slot="footer">
          <i-button type="link" @click="handleReset('formBankConfirm', 'modify')" style="margin-left: 8px">{{ $t('backEdit') }}</i-button>
          <i-button type="primary" @click="handleSubmit('formBankConfirm')">{{ $t('confirmBind') }}</i-button>
        </div>
      </Modal>
    </div>

    <acontact :show="modalWhatsApp" :isWatchupBind="userInfo.watchapp" :locale="locale"></acontact>
    <Modal class="google-modal" v-model="modalGoogle" footer-hide>
      <dl class="text-center">
        <dt><img src="../images/warn.png"/></dt>
        <dd>{{ $t('bindGoogleAuthMsg') }}</dd>
        <dd>
          <i-button @click="toGoogeAuth">
            {{ $t('googleAuthBtn') }} <img src="../images/gauth.png" class="ml-10" />
          </i-button>
        </dd>
      </dl>
    </Modal>
    <Modal v-model="modalOperationOrder" width="500" class="pend-order_modal">
      <div class="g-body">
        <div class="g-body_title">
          <i class="pend-icon icon-wait"></i>
          {{ modalMsg.title }}
        </div>
        <div class="g-body_desc">{{ modalMsg.desc }}</div>
      </div>
      <div slot="footer">
        <i-button type="link" @click="modalOperationOrder = false">{{ $t('cancel') }}</i-button>
        <i-button type="primary" @click="manualAction">{{ modalMsg.confirmText }}</i-button>
      </div>
    </Modal>
  </div>

  <!--footer-->
  @@include('footer.html')
  <script src="../scripts/locale/all_goods.js?rev=@@hash"></script>
  <script src="../scripts/all_goods.js?rev=@@hash"></script>
</body>

</html>