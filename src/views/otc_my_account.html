<!DOCTYPE HTML>
<html lang="zh-cn">

<head>
  <title>UPEX</title>
  @@include('header.html')
  <link rel="stylesheet" href="../styles/my_account.css?rev=@@hash">
</head>

<body>
  <div id="account" v-cloak>
    <o-header ref="header"></o-header>
    <div class="banner">
      {{ $t('myAccount') }}
    </div>
    <div class="container account">
      <!-- 账户与安全信息 -->
      <Row class="container-row">
        <i-col span="12">
          <dl class="account-card">
            <dt>
              <Row class="account-row">
                <i-col span="12">
                  <span class="account-row-title">账户信息</span>
                  <Tag color="#ff4d4d">冻结</Tag>
                </i-col>
                <i-col span="12" class="text-right">
                  <i-button type="text" size="small" @click="loginOut">退出</i-button>
                </i-col>
              </Row>
            </dt>
            <dd>
              <Row>
                <i-col span="8" class="text-secondary">
                  <Icon type="person" color="#cfcfcf" size="16"></Icon>
                  账号
                </i-col>
                <i-col span="8" class="text-strong">{{ user.id }}</i-col>
              </Row>
            </dd>
            <dd>
              <Row>
                <i-col span="8" class="text-secondary">
                  <Icon type="social-whatsapp" color="#cfcfcf" size="16"></Icon>
                  WhatsApp
                </i-col>
                <i-col span="8" class="text-strong">{{ user.userExtView.watchapp }}</i-col>
                <i-col span="8" class="text-right">
                  <i-button type="text" size="small" @click="modifyWhatsApp">修改</i-button>
                </i-col>
              </Row>
            </dd>
            <dd>
              <Row>
                <i-col span="8" class="text-secondary">
                  <Icon type="locked" color="#cfcfcf" size="16"></Icon>
                  密码
                </i-col>
                <i-col span="8" class="text-strong">********</i-col>
                <i-col span="8" class="text-right">
                  <i-button type="text" size="small" @click="modalPassword = true">修改</i-button>
                </i-col>
              </Row>
            </dd>
          </dl>
        </i-col>
        <i-col span="12">
          <dl class="account-card border-left">
            <dt>
              <Row class="account-row">
                <i-col span="12">
                  <span class="account-row-title">安全设置</span>
                  <Badge count="Unsafe"></Badge>
                </i-col>
              </Row>
            </dt>
            <dd>
              <Row>
                <i-col span="8" class="text-secondary">
                  <Icon type="social-google" color="#cfcfcf" size="16"></Icon>
                  Google 身份验证
                </i-col>
                <i-col span="8" class="text-strong">{{ user.googleAuthenticatorStatus ? '已绑定' : '未绑定'}}</i-col>
                <i-col span="8" class="text-right" v-if="user.googleAuthenticatorStatus">
                  <i-switch :value="!!user.googleAuthenticatorStatus" @on-change="modifyGoogleStatus"></i-switch>
                </i-col>
                <i-col span="8" class="text-right" v-else>
                  <i-button type="error" size="small">绑定</i-button>
                </i-col>
              </Row>
            </dd>
            <dd>
              <Row>
                <i-col span="8" class="text-secondary">
                  <Icon type="email" color="#cfcfcf" size="16"></Icon>
                  邮箱
                </i-col>
                <i-col span="8" class="text-strong">{{ user.email ? user.email : '未绑定' }}</i-col>
                <i-col span="8" class="text-right" v-if="user.email">
                  <i-button type="text" size="small" @click="modifyEmail">修改</i-button>
                </i-col>
                <i-col span="8" class="text-right" v-else>
                  <i-button type="error" size="small" @click="modifyEmail">绑定</i-button>
                </i-col>
              </Row>
            </dd>
            <dd>
              <Row>
                <i-col span="8" class="text-secondary">
                  <Icon type="iphone" color="#cfcfcf" size="20"></Icon>
                  手机验证
                </i-col>
                <i-col span="8" class="text-strong">+86-187****2342</i-col>
                <i-col span="8" class="text-right">
                  <i-button type="text" size="small" @click="modalPhone = true">修改</i-button>
                </i-col>
              </Row>
            </dd>
          </dl>
        </i-col>
      </Row>
      <!-- 银行卡列表 -->
      <Row class="container-row">
        <i-col span="24">
          <Row class="account-row">
            <i-col span="12">
              <span class="account-row-title">银行卡</span>
              为了您的账户安全，请使用真实信息绑定银行卡
            </i-col>
            <i-col span="12" class="text-right">
              <i-button type="text" size="small" icon="plus" @click="modifyBankInfo">添加银行卡</i-button>
            </i-col>
          </Row>
          <i-table :columns="bankColumn" :data="bankData"></i-table>
        </i-col>
      </Row>
      <!-- 登录/操作历史 -->
      <div class="container-row" style="margin-top: 2px;">
        <Tabs v-model="tabLogActive">
          <tab-pane label="登录历史" name="loginHistory">
            <i-table :columns="loginColumn" :data="loginData"></i-table>
            <Page :total="loginDataTotalCount" size="small" show-total @on-change="loginPageChange"></Page>
          </tab-pane>
          <tab-pane label="安全记录" name="securityHistory">
            <i-table :columns="securityColumn" :data="securityData"></i-table>
            <Page :total="securityDataTotalCount" size="small" show-total @on-change="securityPageChange"></Page>
          </tab-pane>
        </Tabs>
      </div>
    </div>
    <!-- 修改WhatsApp -->
    <Modal title="修改WhatsApp" v-model="modalWhatsApp">
      <i-form ref="formWhatsApp" :model="formWhatsApp" :rules="ruleWhatsApp" :label-position="top">
        <form-item label="WhatsApp" prop="number">
          <i-input
            v-model="formWhatsApp.number"
            maxlength="30"
            placeholder="Enter your WhatsApp number"
          >
            <i-select class="country-select" v-model="selectCountry" slot="prepend" filterable>
              <i-option
                v-for="(country, index) in countryArr"
                :key="index"
                :value="country.dialingCode"
                :label="country.dialingCode"
                style="width:100%;"
              >
                <span class="float-left">{{country.dialingCode}}</span>
                <span class="float-right" style="color:#aaaaaa;">{{country.enName}}</span>
              </i-option>
            </i-select>
          </i-input>
        </form-item>
      </i-form>
      <div slot="footer">
        <i-button type="text" @click="handleReset('formWhatsApp')" style="margin-left: 8px">取消</i-button>
        <i-button type="primary" @click="handleSubmit('formWhatsApp')">确定</i-button>
      </div>
    </Modal>
    <!-- 修改密码 -->
    <Modal title="修改密码" v-model="modalPassword">
      <i-form ref="formPassword" :model="formPassword" :rules="rulePassword" :label-position="top">
        <form-item label="原密码" prop="passwd">
          <i-input type="password" v-model="formPassword.passwd"></i-input>
        </form-item>
        <form-item label="新密码" prop="passwdNew">
          <i-input type="password" v-model="formPassword.passwdNew"></i-input>
        </form-item>
        <form-item label="重复新密码" prop="passwdReNew">
          <i-input type="text" v-model="formPassword.passwdReNew"></i-input>
        </form-item>
        <form-item label="短信验证码" prop="verify">
          <i-input type="text" v-model="formPassword.verify">
            <i-button slot="append" @click="sendMessage" :disabled="sendDisabled">{{ sendPlaceholder }}</i-button>
          </i-input>
        </form-item>
      </i-form>
      <div slot="footer">
        <i-button type="text" @click="handleReset('formPassword')" style="margin-left: 8px">取消</i-button>
        <i-button type="primary" @click="handleSubmit('formPassword')">确定</i-button>
      </div>
    </Modal>
    <!-- 修改邮箱 -->
    <Modal title="修改邮箱" class="modal-email" v-model="modalEmail">
      <i-form ref="formEmail" :model="formEmail" :rules="ruleEmail" :label-position="top">
        <form-item label="Email" prop="email">
          <i-input v-model="formEmail.email" maxlength="30" placeholder="Enter your Email number">
            <i-button slot="append">发送验证码</i-button>
          </i-input>
        </form-item>
        <form-item label="Verify" prop="verify">
          <i-input v-model="formEmail.verify" maxlength="30" placeholder="Enter your Email number"></i-input>
        </form-item>
      </i-form>
      <div slot="footer">
        <i-button type="text" @click="handleReset('formEmail')" style="margin-left: 8px">取消</i-button>
        <i-button type="primary" @click="handleSubmit('formEmail')">确定</i-button>
      </div>
    </Modal>
    <!-- 修改手机 -->
    <Modal title="修改手机" class="modal-whatsapp" v-model="modalPhone">
      <i-form ref="formPhone" :model="formPhone" :rules="rulePhone" :label-position="top">
        <form-item label="Phone" prop="oldVerify">
          <i-input v-model="formPhone.oldVerify" maxlength="30" placeholder="Enter your phone number">
            <i-button slot="append">发送验证码</i-button>
          </i-input>
        </form-item>
        <form-item label="Phone" prop="phone">
          <i-input v-model="formPhone.phone" maxlength="30" placeholder="Enter your phone number">
            <i-select class="country-select" v-model="selectCountry" slot="prepend" filterable>
              <i-option
                v-for="(country, index) in countryArr"
                :key="index"
                :value="country.dialingCode"
                :label="country.dialingCode"
                style="width:100%;"
              >
                <span class="float-left">{{country.dialingCode}}</span>
                <span class="float-right" style="color:#aaaaaa;">{{country.enName}}</span>
              </i-option>
            </i-select>
          </i-input>
        </form-item>
        <form-item label="Verify" prop="verify">
          <i-input v-model="formPhone.verify" maxlength="30" placeholder="Enter your verify number">
              <i-button slot="append">发送验证码</i-button>
          </i-input>
        </form-item>
      </i-form>
      <div slot="footer">
        <i-button type="text" @click="handleReset('formPhone')" style="margin-left: 8px">取消</i-button>
        <i-button type="primary" @click="handleSubmit('formPhone')">确定</i-button>
      </div>
    </Modal>
    <!-- 添加/修改银行卡 -->
    <div>
      <Modal title="修改银行卡" v-model="modalBankInfo">
        <i-form ref="formBankInfo" :model="formBankInfo" :rules="ruleBankInfo" :label-position="top">
          <form-item label="银行名称" prop="bankName">
            <i-input v-model="formBankInfo.bankName" maxlength="30" placeholder="Enter your bank name"></i-input>
          </form-item>
          <form-item label="账户名称" prop="name">
            <i-input v-model="formBankInfo.name" maxlength="30" placeholder="Enter your account name"></i-input>
          </form-item>
          <form-item label="卡号" prop="cardNo">
            <i-input v-model="formBankInfo.cardNo" maxlength="30" placeholder="Enter your account name"></i-input>
          </form-item>
          <form-item label="iban号码" prop="ibanNo">
            <i-input v-model="formBankInfo.ibanNo" maxlength="30" placeholder="Enter your account ibanNo"></i-input>
          </form-item>
        </i-form>
        <div slot="footer">
          <i-button type="text" @click="handleReset('formBankInfo')" style="margin-left: 8px">取消</i-button>
          <i-button type="primary" @click="handleSubmit('formBankInfo')">确定</i-button>
        </div>
      </Modal>
      <Modal title="确认绑定" class="modal-notice info" v-model="modalBankConfirm">
        <div class="modal-notice-header">
          <Row>
            <i-col span="8" class="text-secondary">银行名称</i-col>
            <i-col span="16" class="text-strong">{{ formBankInfo.bankName }}</i-col>
          </Row>
          <Row>
            <i-col span="8" class="text-secondary">账户名称</i-col>
            <i-col span="16" class="text-strong">{{ formBankInfo.name }}</i-col>
          </Row>
          <Row>
            <i-col span="8" class="text-secondary">银行卡号</i-col>
            <i-col span="16" class="text-strong">{{ formBankInfo.cardNo }}</i-col>
          </Row>
          <Row>
            <i-col span="8" class="text-secondary">iban号码</i-col>
            <i-col span="16" class="text-strong">{{ formBankInfo.ibanNo }}</i-col>
          </Row>
        </div>
        <div class="modal-notice-footer">
          <i-form ref="formBankConfirm" :model="formBankConfirm" :rules="ruleBankConfirm" :label-position="top">
            <Tabs v-model="tabVerifyActive">
              <tab-pane label="谷歌验证" name="1">
                <form-item label="" prop="google">
                  <i-input v-model="formBankConfirm.google" maxlength="30" placeholder="Enter your account name"></i-input>
                </form-item>
              </tab-pane>
              <tab-pane label="手机验证" name="2">
                <form-item label="" prop="phone">
                  <i-input v-model="formBankConfirm.phone" maxlength="6" placeholder="Enter your phone number">
                    <i-button slot="append">发送验证码</i-button>
                  </i-input>
                </form-item>
              </tab-pane>
            </Tabs>
          </i-form>
        </div>
        <div slot="footer">
          <i-button type="text" @click="handleReset('formBankConfirm')" style="margin-left: 8px">取消</i-button>
          <i-button type="primary" @click="handleSubmit('formBankConfirm')">确定</i-button>
        </div>
      </Modal>
    </div>
  </div>
  @@include('footer.html')
  <script src="../scripts/locale/my_account.js?rev=@@hash"></script>
  <script src="../scripts/my_account.js?rev=@@hash"></script>
</body>

</html>